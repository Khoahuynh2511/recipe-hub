function T(e){return new Promise((t,o)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>o(e.error)})}function N(e,t){let o;const r=()=>{if(o)return o;const n=indexedDB.open(e);return n.onupgradeneeded=()=>n.result.createObjectStore(t),o=T(n),o.then(a=>{a.onclose=()=>o=void 0},()=>{}),o};return(n,a)=>r().then(s=>a(s.transaction(t,n).objectStore(t)))}let O;function q(){return O||(O=N("keyval-store","keyval")),O}function M(e,t=q()){return t("readonly",o=>T(o.get(e)))}function j(e,t,o=q()){return o("readwrite",r=>(r.put(t,e),T(r.transaction)))}const D=N("recipe-hub-db","user-data"),d={COOKBOOK:"cookbook",SHOPPING_LIST:"shopping-list",FAVORITES:"favorites",RECENT_VIEWS:"recent-views"},w=typeof window<"u";function P(){try{return w&&typeof indexedDB<"u"}catch{return!1}}function A(){try{return w&&typeof localStorage<"u"}catch{return!1}}const H={async get(e){try{if(!A())return;const t=localStorage.getItem(e);return t?JSON.parse(t):void 0}catch(t){console.error("Error reading from localStorage:",t);return}},async set(e,t){try{if(!A())return;localStorage.setItem(e,JSON.stringify(t))}catch(o){console.error("Error writing to localStorage:",o)}},async del(e){try{if(!A())return;localStorage.removeItem(e)}catch(t){console.error("Error removing from localStorage:",t)}}};async function K(e){if(w)try{return P()?await M(e,D):await H.get(e)}catch(t){console.error(`Error retrieving ${e}:`,t);return}}async function u(e,t){if(w)try{P()?await j(e,t,D):await H.set(e,t)}catch(o){console.error(`Error storing ${e}:`,o)}}async function S(){return await K(d.COOKBOOK)||[]}async function Z(e){const t=await S();t.some(r=>r.id===e.id&&r.type===e.type)||(t.push({...e,dateAdded:Date.now()}),await u(d.COOKBOOK,t))}async function F(e,t){const r=(await S()).filter(n=>!(n.id===e&&n.type===t));await u(d.COOKBOOK,r)}async function ee(e,t){return(await S()).some(r=>r.id===e&&r.type===t)}async function v(){return await K(d.SHOPPING_LIST)||[]}async function te(e){const t=await v(),o=t.findIndex(r=>r.name.toLowerCase()===e.name.toLowerCase()&&r.category===e.category);o>=0?(t[o].quantity=W(t[o].quantity,e.quantity),e.recipe&&!t[o].recipe?.includes(e.recipe)&&(t[o].recipe=t[o].recipe?`${t[o].recipe}, ${e.recipe}`:e.recipe)):t.push({...e,dateAdded:Date.now()}),await u(d.SHOPPING_LIST,t)}async function G(e,t){const r=(await v()).map(n=>n.id===e?{...n,...t}:n);await u(d.SHOPPING_LIST,r)}async function R(e){const o=(await v()).filter(r=>r.id!==e);await u(d.SHOPPING_LIST,o)}async function _(){await u(d.SHOPPING_LIST,[])}function W(e,t){if(!e)return t;if(!t)return e;const o=parseFloat(e),r=parseFloat(t);return!isNaN(o)&&!isNaN(r)?`${o+r}`:`${e}, ${t}`}async function V(){const e=await v();e.sort((o,r)=>o.category.localeCompare(r.category));let t=`Item,Quantity,Category,Recipe
`;for(const o of e){const r=o.name.includes(",")?`"${o.name}"`:o.name,n=o.quantity.includes(",")?`"${o.quantity}"`:o.quantity,a=o.recipe?.includes(",")?`"${o.recipe}"`:o.recipe||"";t+=`${r},${n},${o.category},${a}
`}return t}const Q=document.getElementById("mobile-menu-button"),z=document.getElementById("mobile-menu");Q?.addEventListener("click",()=>{z?.classList.toggle("hidden")});const J=document.getElementById("toggle-sidebar"),U=document.getElementById("close-sidebar"),h=document.getElementById("sidebar");J?.addEventListener("click",()=>{h?.classList.toggle("translate-x-full"),h?.classList.contains("translate-x-full")||(I(),B())});U?.addEventListener("click",()=>{h?.classList.add("translate-x-full")});const m=document.getElementById("tab-cookbook"),y=document.getElementById("tab-shopping"),L=document.getElementById("cookbook-panel"),x=document.getElementById("shopping-panel");m?.addEventListener("click",()=>{m.classList.add("border-primary-500","text-primary-600"),m.classList.remove("border-transparent","text-gray-500"),y?.classList.remove("border-primary-500","text-primary-600"),y?.classList.add("border-transparent","text-gray-500"),L?.classList.remove("hidden"),x?.classList.add("hidden"),I()});y?.addEventListener("click",()=>{y.classList.add("border-primary-500","text-primary-600"),y.classList.remove("border-transparent","text-gray-500"),m?.classList.remove("border-primary-500","text-primary-600"),m?.classList.add("border-transparent","text-gray-500"),x?.classList.remove("hidden"),L?.classList.add("hidden"),B()});async function I(){try{const e=document.getElementById("cookbook-list"),t=document.getElementById("cookbook-empty");if(!e)return;const o=await S();if(e.querySelectorAll(".cookbook-item").forEach(n=>n.remove()),o.length===0){t?.classList.remove("hidden");return}else t?.classList.add("hidden");o.forEach(n=>{const a=n.data,s=n.type==="meal"?a.strMeal:a.strDrink,g=n.type==="meal"?a.strMealThumb:a.strDrinkThumb,i=document.createElement("div");i.className="cookbook-item bg-white rounded-lg shadow p-3 flex gap-3",i.innerHTML=`
          <img src="${g}/preview" alt="${s}" class="w-16 h-16 object-cover rounded-md" />
          <div class="flex-1 min-w-0">
            <h4 class="font-medium text-gray-900 truncate">${s}</h4>
            <p class="text-sm text-gray-500 capitalize">${n.type}</p>
            <div class="mt-1 flex gap-1">
              <a href="/recipe/${n.type}/${n.id}" class="text-xs px-2 py-0.5 rounded bg-primary-100 text-primary-700 hover:bg-primary-200">View</a>
              <button class="remove-recipe text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-700 hover:bg-gray-200" data-id="${n.id}" data-type="${n.type}">Remove</button>
            </div>
          </div>
        `,e.appendChild(i),i.querySelector(".remove-recipe")?.addEventListener("click",async $=>{const f=$.currentTarget.getAttribute("data-id"),l=$.currentTarget.getAttribute("data-type");await F(f,l),i.remove(),e.querySelectorAll(".cookbook-item").length===0&&t?.classList.remove("hidden"),document.dispatchEvent(new CustomEvent("cookbook-updated"))})})}catch(e){console.error("Error loading cookbook items:",e)}}async function B(){try{const e=document.getElementById("shopping-list"),t=document.getElementById("shopping-empty");if(!e)return;const o=await v();if(e.querySelectorAll(".shopping-item").forEach(s=>s.remove()),e.querySelectorAll(".category-header").forEach(s=>s.remove()),o.length===0){t?.classList.remove("hidden");return}else t?.classList.add("hidden");const a={};o.forEach(s=>{a[s.category]||(a[s.category]=[]),a[s.category].push(s)}),Object.keys(a).sort().forEach(s=>{const g=document.createElement("div");g.className="category-header text-sm font-medium text-gray-500 capitalize mt-4 mb-2",g.textContent=s,e.appendChild(g),a[s].forEach(i=>{const c=document.createElement("div");c.className="shopping-item flex items-center gap-2 bg-white rounded-lg shadow-sm p-2",c.dataset.category=s,c.innerHTML=`
            <input type="checkbox" class="shopping-checkbox h-4 w-4 text-primary-600 rounded border-gray-300" data-id="${i.id}" ${i.checked?"checked":""}>
            <div class="flex-1 min-w-0">
              <div class="flex justify-between">
                <div class="font-medium text-sm ${i.checked?"line-through text-gray-400":"text-gray-700"}">${i.name}</div>
                <div class="text-xs text-gray-500">${i.quantity}</div>
              </div>
              ${i.recipe?`<div class="text-xs text-gray-500">From: ${i.recipe}</div>`:""}
            </div>
            <button class="remove-item text-gray-400 hover:text-gray-600" data-id="${i.id}">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          `,e.appendChild(c),c.querySelector(".shopping-checkbox")?.addEventListener("change",async l=>{const b=l.currentTarget.getAttribute("data-id"),C=l.currentTarget.checked;await G(b,{checked:C});const k=c.querySelector(".font-medium");C?(k?.classList.add("line-through","text-gray-400"),k?.classList.remove("text-gray-700")):(k?.classList.remove("line-through","text-gray-400"),k?.classList.add("text-gray-700"))});const f=c.querySelector(".remove-item");f?.addEventListener("click",async()=>{const l=f.getAttribute("data-id");await R(l);const b=e.querySelector(`.category-header:has(+ .shopping-item[data-category="${s}"])`);c.remove(),e.querySelectorAll(`.shopping-item[data-category="${s}"]`).length===0&&b&&b.remove(),e.querySelectorAll(".shopping-item").length===0&&t?.classList.remove("hidden"),document.dispatchEvent(new CustomEvent("shopping-list-updated"))})})})}catch(e){console.error("Error loading shopping list:",e)}}const Y=document.getElementById("export-shopping-list");Y?.addEventListener("click",async()=>{try{const e=await V(),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(t),r=document.createElement("a");r.setAttribute("href",o),r.setAttribute("download",`shopping-list-${new Date().toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(e){console.error("Error exporting shopping list:",e)}});const X=document.getElementById("clear-shopping-list");X?.addEventListener("click",()=>{if(confirm("Are you sure you want to clear your shopping list?"))try{_();const e=document.getElementById("shopping-list"),t=document.getElementById("shopping-empty");e?.querySelectorAll(".shopping-item")?.forEach(n=>n.remove()),e?.querySelectorAll(".category-header")?.forEach(n=>n.remove()),t?.classList.remove("hidden"),document.dispatchEvent(new CustomEvent("shopping-list-updated"))}catch(e){console.error("Error clearing shopping list:",e)}});document.addEventListener("cookbook-updated",()=>{I()});document.addEventListener("shopping-list-updated",()=>{B()});let p;const E=document.getElementById("install-app");window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),p=e,E?.classList.remove("hidden")});E?.addEventListener("click",async()=>{p&&(p.prompt(),await p.userChoice,E.classList.add("hidden"),p=null)});window.addEventListener("appinstalled",()=>{E?.classList.add("hidden"),p=null});document.addEventListener("DOMContentLoaded",()=>{h&&!h.classList.contains("translate-x-full")&&(L&&!L.classList.contains("hidden")&&I(),x&&!x.classList.contains("hidden")&&B())});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{console.log("Service Worker registered with scope:",e.scope)}).catch(e=>{console.error("Service Worker registration failed:",e)})});export{Z as a,te as b,ee as i,F as r};
